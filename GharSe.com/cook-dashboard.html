<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cook Dashboard - GharSe</title>
    <link rel="icon" href="Gharse.png" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <img src="logo.png" alt="GharSe" class="logo">
                <span class="brand-text">GharSe Cook</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Customer View</a>
                <button class="btn btn-outline" onclick="logout()">Logout</button>
            </div>
        </nav>
    </header>

    <main class="cook-dashboard-main">
        <div class="container">
            <!-- Welcome Section -->
            <div class="dashboard-welcome">
                <h1>Welcome, <span id="cookName">Chef</span>!</h1>
                <p>Manage your kitchen, orders, and earnings from your dashboard</p>
            </div>

            <!-- Quick Stats -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalEarnings">‚Çπ0</div>
                        <div class="stat-label">Total Earnings</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-info">
                        <div class="stat-number" id="averageRating">0.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalCustomers">0</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tabs -->
            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="orders" onclick="switchTab('orders')">
                    Active Orders
                </button>
                <button class="tab-btn" data-tab="menu" onclick="switchTab('menu')">
                    Manage Menu
                </button>
                <button class="tab-btn" data-tab="kitchen" onclick="switchTab('kitchen')">
                    Kitchen Profile
                </button>
                <button class="tab-btn" data-tab="earnings" onclick="switchTab('earnings')">
                    Earnings
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Active Orders Tab -->
                <div class="tab-panel active" id="ordersPanel">
                    <div class="panel-header">
                        <h2>Active Orders</h2>
                        <div class="order-filters">
                            <select id="orderStatusFilter" onchange="filterOrdersByStatus()">
                                <option value="all">All Orders</option>
                                <option value="placed">New Orders</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="preparing">Preparing</option>
                                <option value="on-way">Out for Delivery</option>
                            </select>
                        </div>
                    </div>
                    <div class="orders-grid" id="activeOrders">
                        <!-- Orders will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Menu Management Tab -->
                <div class="tab-panel" id="menuPanel">
                    <div class="panel-header">
                        <h2>Menu Management</h2>
                        <button class="btn btn-primary" onclick="openAddDishModal()">
                            Add New Dish
                        </button>
                    </div>
                    <div class="menu-grid" id="menuItems">
                        <!-- Menu items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Kitchen Profile Tab -->
                <div class="tab-panel" id="kitchenPanel">
                    <div class="panel-header">
                        <h2>Kitchen Profile</h2>
                        <button class="btn btn-primary" onclick="editKitchenProfile()">
                            Edit Profile
                        </button>
                    </div>
                    <div class="kitchen-profile-content" id="kitchenProfile">
                        <!-- Kitchen profile will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Earnings Tab -->
                <div class="tab-panel" id="earningsPanel">
                    <div class="panel-header">
                        <h2>Earnings Overview</h2>
                        <div class="earnings-period">
                            <select id="earningsPeriod" onchange="updateEarningsView()">
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="earnings-content" id="earningsContent">
                        <!-- Earnings content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Dish Modal -->
    <div class="modal-overlay hidden" id="dishModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="dishModalTitle">Add New Dish</h2>
                <button class="modal-close" onclick="closeDishModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="dishForm">
                    <div class="form-group">
                        <label for="dishName">Dish Name</label>
                        <input type="text" id="dishName" name="name" class="input-field" required>
                    </div>
                    <div class="form-group">
                        <label for="dishPrice">Price (‚Çπ)</label>
                        <input type="number" id="dishPrice" name="price" class="input-field" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="dishImage">Emoji/Icon</label>
                        <input type="text" id="dishImage" name="image" class="input-field" placeholder="üçõ" required>
                    </div>
                    <div class="form-group">
                        <label for="dishDescription">Description (Optional)</label>
                        <textarea id="dishDescription" name="description" class="input-field" rows="3" placeholder="Describe your dish..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="dishCategory">Category</label>
                        <select id="dishCategory" name="category" class="input-field" required>
                            <option value="">Select Category</option>
                            <option value="main-course">Main Course</option>
                            <option value="starter">Starter</option>
                            <option value="dessert">Dessert</option>
                            <option value="beverage">Beverage</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dishAvailable" name="available" checked>
                            Available for order
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full" id="dishSubmitBtn">Add Dish</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Kitchen Profile Edit Modal -->
    <div class="modal-overlay hidden" id="kitchenProfileModal">
        <div class="modal large-modal">
            <div class="modal-header">
                <h2>Edit Kitchen Profile</h2>
                <button class="modal-close" onclick="closeKitchenProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="kitchenProfileForm">
                    <div class="form-group">
                        <label for="kitchenName">Kitchen Name</label>
                        <input type="text" id="kitchenName" name="name" class="input-field" required>
                    </div>
                    <div class="form-group">
                        <label for="kitchenDescription">Description</label>
                        <textarea id="kitchenDescription" name="description" class="input-field" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kitchenCuisine">Cuisine Type</label>
                            <select id="kitchenCuisine" name="cuisine" class="input-field" required>
                                <option value="bengali">Bengali</option>
                                <option value="south-indian">South Indian</option>
                                <option value="north-indian">North Indian</option>
                                <option value="punjabi">Punjabi</option>
                                <option value="gujarati">Gujarati</option>
                                <option value="maharashtrian">Maharashtrian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="kitchenLocation">Location</label>
                            <input type="text" id="kitchenLocation" name="location" class="input-field" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cookExperience">Experience (years)</label>
                            <input type="number" id="cookExperience" name="experience" class="input-field" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="cookSpeciality">Speciality</label>
                            <input type="text" id="cookSpeciality" name="speciality" class="input-field" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Update Profile</button>
                </form>
            </div>
        </div>
    </div>

    <style>
        .cook-dashboard-main {
            padding-top: 100px;
            min-height: 100vh;
            background: var(--background-warm);
        }

        .dashboard-welcome {
            text-align: center;
            margin-bottom: 3rem;
        }

        .dashboard-welcome h1 {
            font-size: 2.5rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-light);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .stat-icon {
            font-size: 2rem;
            background: var(--background-warm);
            padding: 1rem;
            border-radius: 12px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .dashboard-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-light);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            white-space: nowrap;
        }

        .tab-btn:hover,
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-light);
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .panel-header h2 {
            color: var(--text-dark);
            margin: 0;
        }

        .order-filters select,
        .earnings-period select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            background: white;
        }

        .orders-grid {
            display: grid;
            gap: 1.5rem;
        }

        .order-card {
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1.5rem;
            transition: var(--transition);
        }

        .order-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .order-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .order-id {
            font-weight: 700;
            color: var(--text-dark);
        }

        .order-time {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .order-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-status-badge.placed {
            background: #fff3cd;
            color: #856404;
        }

        .order-status-badge.confirmed {
            background: #cce5ff;
            color: #004085;
        }

        .order-status-badge.preparing {
            background: #ffeaa7;
            color: #636e72;
        }

        .order-items-list {
            margin-bottom: 1rem;
        }

        .order-item-small {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .order-item-small:last-child {
            border-bottom: none;
        }

        .order-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .order-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .menu-item-card {
            border: 1px solid var(--border-light);
            border-radius: 8px;
            overflow: hidden;
            transition: var(--transition);
        }

        .menu-item-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .menu-item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--background-warm);
        }

        .menu-item-emoji {
            font-size: 2rem;
        }

        .menu-item-info {
            flex: 1;
        }

        .menu-item-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .menu-item-price {
            color: var(--primary-color);
            font-weight: 600;
        }

        .menu-item-body {
            padding: 1rem;
        }

        .menu-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .toggle-availability {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .toggle-availability.unavailable {
            background: var(--text-light);
        }

        .kitchen-profile-content {
            display: grid;
            gap: 2rem;
        }

        .profile-section {
            background: var(--background-warm);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .profile-section h3 {
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .profile-details {
            display: grid;
            gap: 1rem;
        }

        .profile-detail {
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .detail-value {
            color: var(--text-light);
        }

        .earnings-content {
            display: grid;
            gap: 2rem;
        }

        .earnings-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .earnings-card {
            background: var(--background-warm);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .earnings-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .earnings-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .large-modal {
            width: 90%;
            max-width: 600px;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .availability-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .availability-badge.available {
            background: #d4edda;
            color: #155724;
        }

        .availability-badge.unavailable {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .dashboard-tabs {
                flex-direction: column;
            }
            
            .panel-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .order-actions {
                flex-direction: column;
            }
            
            .menu-item-actions {
                flex-direction: column;
            }
        }
    </style>

    <script src="script.js"></script>
    <script>
        let currentTab = 'orders';
        let currentKitchen = null;
        let editingDish = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!app.isAuthenticated) {
                window.location.href = 'auth.html';
                return;
            }

            initializeCookDashboard();
        });

        function initializeCookDashboard() {
            setupCookProfile();
            updateStats();
            loadActiveOrders();
            loadMenuItems();
            loadKitchenProfile();
            loadEarnings();
        }

        function setupCookProfile() {
            const cookName = document.getElementById('cookName');
            if (cookName && app.currentUser) {
                cookName.textContent = app.currentUser.name || 'Chef';
            }

            // Initialize or find cook's kitchen
            let cookKitchen = app.kitchens.find(k => k.cook?.email === app.currentUser?.email);
            if (!cookKitchen) {
                // Create a default kitchen for new cooks
                cookKitchen = {
                    id: 'k_' + Date.now(),
                    name: `${app.currentUser.name}'s Kitchen`,
                    cuisine: 'north-indian',
                    location: app.currentUser.location || 'Your Location',
                    rating: 4.5,
                    reviews: 0,
                    priceRange: '‚Çπ80-150',
                    description: 'Delicious home-cooked meals made with love and care.',
                    dishes: [],
                    cook: {
                        name: app.currentUser.name,
                        email: app.currentUser.email,
                        experience: '5 years',
                        speciality: 'Home Style Cooking'
                    }
                };
                app.kitchens.push(cookKitchen);
                localStorage.setItem('gharSe_kitchens', JSON.stringify(app.kitchens));
            }
            currentKitchen = cookKitchen;
        }

        function updateStats() {
            // Calculate stats based on orders for this cook's kitchen
            const cookOrders = app.orders.filter(order => 
                order.items.some(item => item.kitchenId === currentKitchen?.id)
            );

            const totalEarnings = cookOrders.reduce((sum, order) => {
                const cookItems = order.items.filter(item => item.kitchenId === currentKitchen?.id);
                return sum + cookItems.reduce((itemSum, item) => itemSum + (item.dish.price * item.quantity), 0);
            }, 0);

            const deliveredOrders = cookOrders.filter(order => order.status === 'delivered');
            const uniqueCustomers = new Set(cookOrders.map(order => order.userId)).size;

            document.getElementById('totalEarnings').textContent = `‚Çπ${totalEarnings}`;
            document.getElementById('totalOrders').textContent = cookOrders.length.toString();
            document.getElementById('averageRating').textContent = currentKitchen?.rating?.toFixed(1) || '0.0';
            document.getElementById('totalCustomers').textContent = uniqueCustomers.toString();
        }

        function switchTab(tabName) {
            currentTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update tab panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabName}Panel`).classList.add('active');

            // Load tab-specific content
            switch(tabName) {
                case 'orders':
                    loadActiveOrders();
                    break;
                case 'menu':
                    loadMenuItems();
                    break;
                case 'kitchen':
                    loadKitchenProfile();
                    break;
                case 'earnings':
                    loadEarnings();
                    break;
            }
        }

        function loadActiveOrders() {
            const ordersContainer = document.getElementById('activeOrders');
            const cookOrders = app.orders.filter(order => 
                order.items.some(item => item.kitchenId === currentKitchen?.id) &&
                !['delivered', 'cancelled'].includes(order.status)
            ).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (cookOrders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>No active orders</h3>
                        <p>Your new orders will appear here when customers place them.</p>
                    </div>
                `;
                return;
            }

            ordersContainer.innerHTML = '';
            cookOrders.forEach(order => {
                const cookItems = order.items.filter(item => item.kitchenId === currentKitchen?.id);
                if (cookItems.length === 0) return;

                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                orderCard.innerHTML = `
                    <div class="order-card-header">
                        <div>
                            <div class="order-id">Order #${order.id.slice(-6).toUpperCase()}</div>
                            <div class="order-time">${new Date(order.createdAt).toLocaleString()}</div>
                        </div>
                        <div class="order-status-badge ${order.status}">
                            ${formatOrderStatus(order.status)}
                        </div>
                    </div>
                    
                    <div class="order-items-list">
                        ${cookItems.map(item => `
                            <div class="order-item-small">
                                <span>${item.dish.image} ${item.dish.name} x${item.quantity}</span>
                                <span>‚Çπ${item.dish.price * item.quantity}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="order-actions">
                        ${order.status === 'placed' ? `
                            <button class="btn btn-success" onclick="updateOrderStatus('${order.id}', 'confirmed')">
                                Accept Order
                            </button>
                            <button class="btn btn-error" onclick="updateOrderStatus('${order.id}', 'cancelled')">
                                Reject Order
                            </button>
                        ` : ''}
                        ${order.status === 'confirmed' ? `
                            <button class="btn btn-primary" onclick="updateOrderStatus('${order.id}', 'preparing')">
                                Start Preparing
                            </button>
                        ` : ''}
                        ${order.status === 'preparing' ? `
                            <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'on-way')">
                                Ready for Delivery
                            </button>
                        ` : ''}
                        ${order.status === 'on-way' ? `
                            <button class="btn btn-success" onclick="updateOrderStatus('${order.id}', 'delivered')">
                                Mark as Delivered
                            </button>
                        ` : ''}
                        <button class="btn btn-outline" onclick="viewOrderDetails('${order.id}')">
                            View Details
                        </button>
                    </div>
                `;
                ordersContainer.appendChild(orderCard);
            });
        }

        function loadMenuItems() {
            const menuContainer = document.getElementById('menuItems');
            
            if (!currentKitchen?.dishes || currentKitchen.dishes.length === 0) {
                menuContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>No menu items yet</h3>
                        <p>Start building your menu by adding your signature dishes.</p>
                        <button class="btn btn-primary" onclick="openAddDishModal()">Add Your First Dish</button>
                    </div>
                `;
                return;
            }

            menuContainer.innerHTML = '';
            currentKitchen.dishes.forEach(dish => {
                const menuCard = document.createElement('div');
                menuCard.className = 'menu-item-card';
                menuCard.innerHTML = `
                    <div class="menu-item-header">
                        <div class="menu-item-emoji">${dish.image}</div>
                        <div class="menu-item-info">
                            <div class="menu-item-name">${dish.name}</div>
                            <div class="menu-item-price">‚Çπ${dish.price}</div>
                        </div>
                        <div class="availability-badge ${dish.available !== false ? 'available' : 'unavailable'}">
                            ${dish.available !== false ? 'Available' : 'Unavailable'}
                        </div>
                    </div>
                    <div class="menu-item-body">
                        ${dish.description ? `<p style="margin-bottom: 1rem; color: var(--text-light);">${dish.description}</p>` : ''}
                        <div class="menu-item-actions">
                            <button class="btn btn-outline" onclick="editDish('${dish.id}')">Edit</button>
                            <button class="toggle-availability ${dish.available === false ? 'unavailable' : ''}" 
                                    onclick="toggleDishAvailability('${dish.id}')">
                                ${dish.available !== false ? 'Mark Unavailable' : 'Mark Available'}
                            </button>
                            <button class="btn btn-error" onclick="deleteDish('${dish.id}')">Delete</button>
                        </div>
                    </div>
                `;
                menuContainer.appendChild(menuCard);
            });
        }

        function loadKitchenProfile() {
            const profileContainer = document.getElementById('kitchenProfile');
            
            profileContainer.innerHTML = `
                <div class="profile-section">
                    <h3>Basic Information</h3>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <span class="detail-label">Kitchen Name:</span>
                            <span class="detail-value">${currentKitchen?.name || 'Not set'}</span>
                        </div>
                        <div class="profile-detail">
                            <span class="detail-label">Cuisine Type:</span>
                            <span class="detail-value">${formatCuisine(currentKitchen?.cuisine || '')}</span>
                        </div>
                        <div class="profile-detail">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">${currentKitchen?.location || 'Not set'}</span>
                        </div>
                        <div class="profile-detail">
                            <span class="detail-label">Rating:</span>
                            <span class="detail-value">${currentKitchen?.rating || 0} ‚≠ê (${currentKitchen?.reviews || 0} reviews)</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3>Chef Information</h3>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <span class="detail-label">Chef Name:</span>
                            <span class="detail-value">${currentKitchen?.cook?.name || 'Not set'}</span>
                        </div>
                        <div class="profile-detail">
                            <span class="detail-label">Experience:</span>
                            <span class="detail-value">${currentKitchen?.cook?.experience || 'Not set'}</span>
                        </div>
                        <div class="profile-detail">
                            <span class="detail-label">Speciality:</span>
                            <span class="detail-value">${currentKitchen?.cook?.speciality || 'Not set'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3>Description</h3>
                    <p>${currentKitchen?.description || 'No description provided.'}</p>
                </div>
            `;
        }

        function loadEarnings() {
            const earningsContainer = document.getElementById('earningsContent');
            
            const cookOrders = app.orders.filter(order => 
                order.items.some(item => item.kitchenId === currentKitchen?.id)
            );

            const totalEarnings = cookOrders.reduce((sum, order) => {
                const cookItems = order.items.filter(item => item.kitchenId === currentKitchen?.id);
                return sum + cookItems.reduce((itemSum, item) => itemSum + (item.dish.price * item.quantity), 0);
            }, 0);

            const thisWeekEarnings = totalEarnings * 0.3; // Placeholder calculation
            const thisMonthEarnings = totalEarnings * 0.8; // Placeholder calculation

            earningsContainer.innerHTML = `
                <div class="earnings-summary">
                    <div class="earnings-card">
                        <div class="earnings-amount">‚Çπ${thisWeekEarnings.toFixed(0)}</div>
                        <div class="earnings-label">This Week</div>
                    </div>
                    <div class="earnings-card">
                        <div class="earnings-amount">‚Çπ${thisMonthEarnings.toFixed(0)}</div>
                        <div class="earnings-label">This Month</div>
                    </div>
                    <div class="earnings-card">
                        <div class="earnings-amount">‚Çπ${totalEarnings}</div>
                        <div class="earnings-label">Total Earnings</div>
                    </div>
                    <div class="earnings-card">
                        <div class="earnings-amount">${cookOrders.length}</div>
                        <div class="earnings-label">Total Orders</div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3>Recent Orders</h3>
                    ${cookOrders.length === 0 ? 
                        '<p>No orders yet. Your earnings will appear here once you start receiving orders.</p>' :
                        cookOrders.slice(0, 5).map(order => {
                            const cookItems = order.items.filter(item => item.kitchenId === currentKitchen?.id);
                            const orderEarnings = cookItems.reduce((sum, item) => sum + (item.dish.price * item.quantity), 0);
                            return `
                                <div class="profile-detail">
                                    <span class="detail-label">Order #${order.id.slice(-6).toUpperCase()}</span>
                                    <span class="detail-value">‚Çπ${orderEarnings} - ${new Date(order.createdAt).toLocaleDateString()}</span>
                                </div>
                            `;
                        }).join('')
                    }
                </div>
            `;
        }

        function formatOrderStatus(status) {
            const statuses = {
                'placed': 'New Order',
                'confirmed': 'Confirmed',
                'preparing': 'Preparing',
                'on-way': 'Out for Delivery',
                'delivered': 'Delivered',
                'cancelled': 'Cancelled'
            };
            return statuses[status] || status;
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = app.orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                app.saveToStorage();
                loadActiveOrders();
                updateStats();
                showMessage(`Order ${newStatus === 'cancelled' ? 'rejected' : 'updated'} successfully!`, 'success');
            }
        }

        function filterOrdersByStatus() {
            loadActiveOrders();
        }

        function openAddDishModal() {
            editingDish = null;
            document.getElementById('dishModalTitle').textContent = 'Add New Dish';
            document.getElementById('dishSubmitBtn').textContent = 'Add Dish';
            document.getElementById('dishForm').reset();
            document.getElementById('dishAvailable').checked = true;
            document.getElementById('dishModal').classList.remove('hidden');
        }

        function editDish(dishId) {
            const dish = currentKitchen?.dishes.find(d => d.id === dishId);
            if (!dish) return;

            editingDish = dish;
            document.getElementById('dishModalTitle').textContent = 'Edit Dish';
            document.getElementById('dishSubmitBtn').textContent = 'Update Dish';
            
            document.getElementById('dishName').value = dish.name;
            document.getElementById('dishPrice').value = dish.price;
            document.getElementById('dishImage').value = dish.image;
            document.getElementById('dishDescription').value = dish.description || '';
            document.getElementById('dishCategory').value = dish.category || '';
            document.getElementById('dishAvailable').checked = dish.available !== false;
            
            document.getElementById('dishModal').classList.remove('hidden');
        }

        function closeDishModal() {
            document.getElementById('dishModal').classList.add('hidden');
            editingDish = null;
        }

        function toggleDishAvailability(dishId) {
            const dish = currentKitchen?.dishes.find(d => d.id === dishId);
            if (dish) {
                dish.available = !dish.available;
                
                // Update the kitchen in the main kitchens array
                const kitchenIndex = app.kitchens.findIndex(k => k.id === currentKitchen.id);
                if (kitchenIndex !== -1) {
                    app.kitchens[kitchenIndex] = currentKitchen;
                    localStorage.setItem('gharSe_kitchens', JSON.stringify(app.kitchens));
                }
                
                loadMenuItems();
                showMessage(`Dish ${dish.available ? 'marked as available' : 'marked as unavailable'}`, 'success');
            }
        }

        function deleteDish(dishId) {
            if (confirm('Are you sure you want to delete this dish?')) {
                currentKitchen.dishes = currentKitchen.dishes.filter(d => d.id !== dishId);
                
                // Update the kitchen in the main kitchens array
                const kitchenIndex = app.kitchens.findIndex(k => k.id === currentKitchen.id);
                if (kitchenIndex !== -1) {
                    app.kitchens[kitchenIndex] = currentKitchen;
                    localStorage.setItem('gharSe_kitchens', JSON.stringify(app.kitchens));
                }
                
                loadMenuItems();
                showMessage('Dish deleted successfully', 'success');
            }
        }

        function editKitchenProfile() {
            document.getElementById('kitchenName').value = currentKitchen?.name || '';
            document.getElementById('kitchenDescription').value = currentKitchen?.description || '';
            document.getElementById('kitchenCuisine').value = currentKitchen?.cuisine || '';
            document.getElementById('kitchenLocation').value = currentKitchen?.location || '';
            document.getElementById('cookExperience').value = currentKitchen?.cook?.experience?.replace(' years', '') || '';
            document.getElementById('cookSpeciality').value = currentKitchen?.cook?.speciality || '';
            
            document.getElementById('kitchenProfileModal').classList.remove('hidden');
        }

        function closeKitchenProfileModal() {
            document.getElementById('kitchenProfileModal').classList.add('hidden');
        }

        function updateEarningsView() {
            loadEarnings();
        }

        function viewOrderDetails(orderId) {
            // Reuse the order details function from orders.html
            const order = app.orders.find(o => o.id === orderId);
            if (order) {
                localStorage.setItem('selectedOrder', orderId);
                showMessage('Order details feature will open in a new view', 'info');
            }
        }

        // Handle dish form submission
        document.getElementById('dishForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const dishData = {
                id: editingDish ? editingDish.id : 'd_' + Date.now(),
                name: formData.get('name'),
                price: parseInt(formData.get('price')),
                image: formData.get('image'),
                description: formData.get('description'),
                category: formData.get('category'),
                available: formData.get('available') === 'on'
            };

            if (editingDish) {
                // Update existing dish
                const dishIndex = currentKitchen.dishes.findIndex(d => d.id === editingDish.id);
                if (dishIndex !== -1) {
                    currentKitchen.dishes[dishIndex] = dishData;
                }
            } else {
                // Add new dish
                if (!currentKitchen.dishes) {
                    currentKitchen.dishes = [];
                }
                currentKitchen.dishes.push(dishData);
            }

            // Update the kitchen in the main kitchens array
            const kitchenIndex = app.kitchens.findIndex(k => k.id === currentKitchen.id);
            if (kitchenIndex !== -1) {
                app.kitchens[kitchenIndex] = currentKitchen;
                localStorage.setItem('gharSe_kitchens', JSON.stringify(app.kitchens));
            }

            closeDishModal();
            loadMenuItems();
            showMessage(editingDish ? 'Dish updated successfully!' : 'Dish added successfully!', 'success');
        });

        // Handle kitchen profile form submission
        document.getElementById('kitchenProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            currentKitchen.name = formData.get('name');
            currentKitchen.description = formData.get('description');
            currentKitchen.cuisine = formData.get('cuisine');
            currentKitchen.location = formData.get('location');
            currentKitchen.cook.experience = formData.get('experience') + ' years';
            currentKitchen.cook.speciality = formData.get('speciality');

            // Update the kitchen in the main kitchens array
            const kitchenIndex = app.kitchens.findIndex(k => k.id === currentKitchen.id);
            if (kitchenIndex !== -1) {
                app.kitchens[kitchenIndex] = currentKitchen;
                localStorage.setItem('gharSe_kitchens', JSON.stringify(app.kitchens));
            }

            closeKitchenProfileModal();
            loadKitchenProfile();
            showMessage('Kitchen profile updated successfully!', 'success');
        });
    </script>
</body>
</html>
